<tool id="tl.correlation_matrix" name="tl.correlation_matrix" version="1.3.1+galaxy1">
  <description>Calculate correlation matrix.</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="exit_code"><![CDATA[
        python $script_file
    ]]></command>
  <configfiles>
    <configfile name="script_file"><![CDATA[
import scanpy.api as sc

@CMD_read_inputs

sc.tl.correlation_matrix(
   adata = '$adata',
   name_list = '$name_list',
   groupby = '$groupby',
   group = '$group',
   n_genes = '$n_genes',
   data = '$data',
   method = '$method',
       pearson = '$    pearson',
       kendall = '$    kendall',
       spearman = '$    spearman',
   annotation_key: String, optional (default: None) = '$annotation_key: String, optional (default: None)',)
]]></configfile>
  </configfiles>
  <inputs>
    <expand macro="inputs_anndata"/>
    <param name="name_list" type="data" format="list" value="" optional="true" label="name_list" help="    Takes a list of genes for which to calculate the correlation matrix"/>
    <param name="groupby" type="str" value="" optional="true" label="groupby" help="    If no name list is passed, genes are selected from the    results of rank_gene_groups. Then this is the key of the sample grouping to consider.    Note that in this case also a group index has to be specified."/>
    <param name="group" type="int" value="" optional="true" label="group" help="    Group index for which the correlation matrix for top_ranked genes should be calculated.    Currently only int is supported, will change very soon"/>
    <param name="n_genes" type="int" value="" optional="true" label="n_genes" help="    For how many genes to calculate correlation matrix? If specified, cuts the name list    (in whatever order it is passed)."/>
    <param name="data" type="data" format="{'Complete'" value="" optional="true" label="data" help="    At the moment, this is only relevant for the case that name_list is drawn from rank_gene_groups results.    If specified, collects mask for the called group and then takes only those cells specified.    If 'Complete', calculate correlation using full data    If 'Group', calculate correlation within the selected group.    If 'Rest', calculate corrlation for everything except the group"/>
    <param name="method" type="data" format="{‘pearson’" value="" optional="true" label="method" help="    Which kind of correlation coefficient to use"/>
    <param name="    pearson" type="data" format="standard correlation coefficient" value="" label="    pearson" help=""/>
    <param name="    kendall" type="data" format="Kendall Tau correlation coefficient" value="" label="    kendall" help=""/>
    <param name="    spearman" type="data" format="Spearman rank correlation" value="" label="    spearman" help=""/>
    <param name="annotation_key: String, optional (default: None)" type="data" format="" value="" label="annotation_key: String, optional (default: None)" help="    Allows to define the name of the anndata entry where results are stored."/>
    </inputs>
  <outputs>
    </outputs>
  <tests>
    <test>
      <param name="name_list" value=""/>
      <param name="groupby" value=""/>
      <param name="group" value=""/>
      <param name="n_genes" value=""/>
      <param name="data" value=""/>
      <param name="method" value=""/>
      <param name="    pearson" value=""/>
      <param name="    kendall" value=""/>
      <param name="    spearman" value=""/>
      <param name="annotation_key: String, optional (default: None)" value=""/>
    </test>
  </tests>
  <help><![CDATA[
        Calculate correlation matrix.

Calculate a correlation matrix for genes strored in sample annotation using rank_genes_groups.py

Parameters
----------
adata : :class:`~anndata.AnnData`
    Annotated data matrix.
name_list : list, optional (default: None)
    Takes a list of genes for which to calculate the correlation matrix
groupby : `str`, optional (default: None)
    If no name list is passed, genes are selected from the
    results of rank_gene_groups. Then this is the key of the sample grouping to consider.
    Note that in this case also a group index has to be specified.
group : `int`, optional (default: None)
    Group index for which the correlation matrix for top_ranked genes should be calculated.
    Currently only int is supported, will change very soon
n_genes : `int`, optional (default: 20)
    For how many genes to calculate correlation matrix? If specified, cuts the name list
    (in whatever order it is passed).
data : {'Complete', 'Group', 'Rest'}, optional (default: 'Complete')
    At the moment, this is only relevant for the case that name_list is drawn from rank_gene_groups results.
    If specified, collects mask for the called group and then takes only those cells specified.
    If 'Complete', calculate correlation using full data
    If 'Group', calculate correlation within the selected group.
    If 'Rest', calculate corrlation for everything except the group
method : {‘pearson’, ‘kendall’, ‘spearman’} optional (default: 'pearson')
    Which kind of correlation coefficient to use
    pearson : standard correlation coefficient
    kendall : Kendall Tau correlation coefficient
    spearman : Spearman rank correlation
annotation_key: String, optional (default: None)
    Allows to define the name of the anndata entry where results are stored.
    ]]></help>
  <expand macro="citations"/>
</tool>
