<tool id="tl.score_genes_cell_cycle" name="tl.score_genes_cell_cycle" version="1.3.1+galaxy1">
    <description>Score cell cycle genes</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
        ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.tl.score_genes_cell_cycle(
    adata=adata,
    s_genes=$s_genes.replace(' ','').split(','),
    g2m_genes=$g2m_genes.replace(' ','').split(','),\
    @CMD_score_genes_inputs@)

@CMD_anndata_write_outputs@
adata.obs.to_csv('$obs', sep='\t')
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <param name="s_genes" type="text" value="" label="List of genes associated with S phase" help="Genes separated by a comma"/>
        <param name="g2m_genes" type="text" value="" label="List of genes associated with G2M phase" help="Genes separated by a comma"/>
        <expand macro="score_genes_params"/>
        <expand macro="anndata_output_format"/>
    </inputs>
    <outputs>
        <expand macro="anndata_outputs"/>
        <data name="obs" format="tabular" label="${tool.name} on ${on_string}: Observations annotation"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <param name="s_genes" value="Gata2, Fog1, EgrNab"/>
            <param name="g2m_genes" value="EKLF, Fli1, SCL, Cebpa"/>
            <param name="n_bins" value="2"/>
            <param name="random_state" value="0"/>
            <param name="use_raw" value="False"/>
            <param name="anndata_output_format" value="h5ad" />
            <output name="anndata_out_h5ad" file="tl.score_genes_cell_cycle.krumsiek11.h5ad" ftype="h5" compare="sim_size"/>
            <output name="obs" file="tl.score_genes_cell_cycle.krumsiek11.obs.tabular" ftype="tabular" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Given two lists of genes associated to S phase and G2M phase, calculates
scores and assigns a cell cycle phase (G1, S or G2M). See
`score_genes` for more explanation.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.tl.score_genes_cell_cycle.html#scanpy.api.tl.score_genes_cell_cycle>`_
    ]]></help>
    <expand macro="citations"/>
</tool>
