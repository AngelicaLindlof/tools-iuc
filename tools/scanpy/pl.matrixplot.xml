<tool id="pl.matrixplot" name="pl.matrixplot" version="1.3.1+galaxy1">
    <description>Heatmap of the mean expression values per cluster</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
    ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.settings.figdir = '.'

@CMD_params_var_group@

sc.pl.matrixplot(@CMD_params_plots@ @CMD_params_figsize@ 
    cmap='$matplotlib_pyplot_pcolor.cmap',
#if $matplotlib_pyplot_pcolor.vmin
    vmin=$matplotlib_pyplot_pcolor.vmin,
#end if
#if $matplotlib_pyplot_pcolor.vmax
    vmax=$matplotlib_pyplot_pcolor.vmax,
#end if
    edgecolors='$matplotlib_pyplot_pcolor.edgecolors',
#if $matplotlib_pyplot_pcolor.alpha
    alpha=$matplotlib_pyplot_pcolor.alpha,
#end if
    snap=$matplotlib_pyplot_pcolor.snap,
    show=False)
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="params_plots"/>
        <expand macro="param_figsize"/>
        <section name="matplotlib_pyplot_pcolor" title="Parameters for matplotlib.pyplot.pcolor">
            <param argument="cmap" type="select" label="Color palette">
                <expand macro="seaborn_color_palette_options"/>
            </param>
            <param argument="vmin" type="float" value="" optional="true" label="Minimum value to anchor the colormap" help=""/>
            <param argument="vmax" type="float" value="" optional="true" label="Maximum value to anchor the colormap" help=""/>
            <expand macro="params_matplotlib_pyplot_edgecolors"/>
            <expand macro="params_matplotlib_pyplot_alpha"/>
            <param argument="snap" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Snap the mesh to pixel boundaries?" help=""/>
        </section>
    </inputs>
    <outputs>
        <expand macro="plot_output"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
           <conditional name="var_names">
                <param name="type" value="all"/>
            </conditional>
            <param name="groupby" value="cell_type"/>
            <param name="log" value="False"/>
            <param name="use_raw" value="False"/>
            <param name="num_categories" value="7"/>
            <param name="dendrogram" value="False"/>
            <param name="format" value="png"/>
            <conditional name="figsize">
                <param name="test" value="no"/>
            </conditional>
            <section name="matplotlib_pyplot_pcolor">
                <param name="cmap" value="viridis"/>
                <param name="edgecolors" value="face"/>
                <param name="snap" value="False"/>
            </section>
            <output name="out_png" file="pl.matrixplot.krumsiek11.png" ftype="png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Creates a heatmap of the mean expression values per cluster of each var_names

If groupby is not given, the matrixplot assumes that all data belongs to a single
category.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.matrixplot.html#scanpy.api.pl.matrixplot>`__
    ]]></help>
  <expand macro="citations"/>
</tool>
