<tool id="pl.violin" name="pl.violin" version="1.3.1+galaxy1">
    <description>Violin plot.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
        ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.settings.figdir = '.'

sc.pl.violin(
    adata=adata,
    keys=$keys.replace(' ','').split(','),
#if $groupby
    groupby='$groupby',
#end if
    log=$log,
    use_raw=$use_raw,
    multi_panel=$multi_panel,
    stripplot=$stripplot.stripplot,
#if $stripplot.stripplot == "True"
    jitter=$stripplot.jitter.jitter,
    #if $stripplot.jitter.jitter == "True"
    size=$stripplot.jittersize,
    #end if
#end if
#if $order
    order=$order.replace(' ','').split(','),
#end if
    scale=$scale,
#if $xlabel
    xlabel='$xlabel',
#end if
#if $rotation
    rotation=$rotation,
#end if
    bw=$seaborn_violinplot.bw,
    inner=$seaborn_violinplot.inner,
#if $seaborn_violinplot.orient
    orient=$seaborn_violinplot.orient,
#end if
    linewidth=$seaborn_violinplot.linewidth,
    color=$seaborn_violinplot.color,
    palette=$seaborn_violinplot.palette,
    saturation=$seaborn_violinplot.saturation,
    save='.$format',
    show=False,)
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <param argument="keys" type="text" value="" label="Keys for accessing variables" help="They should be from `.var_names` or fields of `.obs`, and separated by comma."/>
        <expand macro="param_groupby"/>
        <expand macro="param_log"/>
        <expand macro="param_use_raw"/>
        <param argument="multi_panel" type="boolean" truevalue="True" falsevalue="False" check="false" label="Display keys in multiple panels" help="Also when `groupby is not provided"/>
        <conditional name="stripplot">
            <param argument="stripplot" type="select" label="Add a stripplot on top of the violin plot" help="">
                <option value="True">Yes</option>
                <option value="False">No</option>
            </param>
            <when value="True">
                <conditional name="jitter">
                    <param argument="jitter" type="select" label="Add a jitter to the stripplot" help="">
                        <option value="True">Yes</option>
                        <option value="False">No</option>
                    </param>
                    <when value="True">
                        <param argument="size" type="integer" value="1" label="Size of the jitter points" help=""/>
                    </when>
                    <when value="False"/>
                </conditional>
            </when>
            <when value="False"/>
        </conditional>
        <param argument="order" type="text" value="" optional="true" label="Order in which to show the categories" help="Separated by comma"/>
        <param argument="scale" type="select" label="Method used to scale the width of each violin">
            <option value="area">area: each violin will have the same area</option>
            <option value="count">count: the width of the violins will be scaled by the number of observations in that bin</option>
            <option value="width" selected="true">width: each violin will have the same width</option>
        </param>
        <param argument="xlabel" type="text" value="" optional="true" label="Label of the x axis" help="Defaults to `groupby` if `rotation` is `None`,    otherwise, no label is shown."/>
        <param argument="rotation" type="float" value="" optional="true" label="Rotation of xtick labels" help=""/>
        <expand macro="param_plot_format"/>
        <section name="seaborn_violinplot" title="Parameters for seaborn.violinplot">
            <param argument="bw" type="select" label="Name of a reference rule when computing the kernel bandwidth">
                <option value="scott">scott</option>
                <option value="silverman">silverman</option>
            </param>
            <param argument="inner" type="select" label="Representation of the datapoints in the violin interior">
                <option value="box">box: draw a miniature boxplot</option>
                <option value="quartile">quartile: draw the quartiles of the distribution</option>
                <option value="point">point: show each underlying datapoint</option>
                <option value="stick">stick: show each underlying datapoint</option>
                <option value="None">None: draw unadorned violins</option>
            </param>
            <param argument="orient" type="select" optional="true" label="Orientation of the plot">
                <option value="v">vertical</option>
                <option value="h">horizontal</option>
            </param>
            <param argument="linewidth" type="float" value="0" label="Width of the gray lines that frame the plot elements" help=""/>
            <param argument="color" type="select" label="Color for all of the elements" help="">
                <expand macro="matplotlib_color"/>
            </param>
            <param argument="palette" type="select" label="Colors to use for the different levels of the hue variable" help="">
                <expand macro="matplotlib_pyplot_colormap"/>
            </param>
            <param argument="saturation" type="float" value="0.75" min="0" max="1" label="Proportion of the original saturation to draw colors at" help=""/>
        </section>
    <outputs>
        <expand macro="plot_output"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="pp.pca.krumsiek11.h5ad" />
            </conditional>
            <param name="keys" value=""/>
            <param name="groupby" value=""/>
            <param name="log" value=""/>
            <param name="use_raw" value=""/>
            <param name="multi_panel" value=""/>
            <param name="stripplot" value=""/>
            <param name="jitter" value=""/>
            <param name="size" value=""/>
            <param name="order" value=""/>
            <param name="scale" value=""/>
            <param name="xlabel" value=""/>
            <param name="rotation" value=""/>
            <param name="show" value=""/>
            <param name="save" value=""/>
            <param name="ax" value=""/>
            <param name="**kwds" value=""/>
            <expand macro="tests_set_figure_params"/>
            <output name="A `matplotlib.Axes` object if `ax` is `None` else `None`." file=""/>
        </test>
    </tests>
    <help><![CDATA[

Wraps `seaborn.violinplot` for `anndata.AnnData`.

    ]]></help>
  <expand macro="citations"/>
</tool>
