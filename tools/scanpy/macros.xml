<macros>
  <xml name="requirements">
    <requirements>
      <requirement type="package" version="1.3.1">scanpy</requirement>
    </requirements>
  </xml>
  <xml name="citations">
    <citations>
      <citation type="doi">10.1186/s13059-017-1382-0</citation>
    </citations>
  </xml>
  <xml name="inputs_anndata">
    <conditional name="input">
      <param name="format" type="select" label="Format for the annotated data matrix">
        <option value="csv">csv</option>
        <option value="loom">loom</option>
        <option value="h5">h5</option>
      </param>
      <when value="csv">
        <param name="adata" type="data" format="csv" label="Annotated data matrix"/>
      </when>
      <when value="loom">
        <param name="adata" type="data" format="loom" label="Annotated data matrix"/>
        <param name="sparse" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Is the data matrix to read sparse?"/>
        <param name="cleanup" type="boolean" truevalue="True" falsevalue="False" checked="false" label="Cleanup?"/>
        <param name="x_name" type="text" value="spliced" label="X_name"/>
        <param name="obs_names" type="text" value="CellID" label="obs_names"/>
        <param name="var_names" type="text" value="Gene" label="var_names"/>
      </when>
      <when value="h5">
        <param name="adata" type="data" format="h5" label="Annotated data matrix"/>
        <param name="key" type="text" value="" label="Name of dataset in the file"/>
      </when>
    </conditional>
  </xml>
  <token name="@CMD_read_inputs"><![CDATA[
#if $input.format == 'csv'
    adata = sc.read_csv($input.adata, )
# else if $input.format == 'loom'
    adata = sc.read_hdf(
        $input.adata,
        sparse=$input.sparse,
        cleanup=$input.cleanup,
        X_name=$input.x_name,
        obs_names=$input.obs_names,
        var_names=$input.var_names)
# else if $input.format == 'h5'
    adata = sc.read_loom(
        $input.adata,
        key=$input.key)
]]></token>
  <xml name="tests_set_figure_params">
    <param name="scanpy" value=""/>
    <param name="dpi" value=""/>
    <param name="dpi_save" value=""/>
    <param name="frameon" value=""/>
    <param name="vector_friendly" value=""/>
    <param name="color_map" value=""/>
    <param name="format" value=""/>
    <param name="transparent" value=""/>
    <param name="ipython_format" value=""/>
  </xml>
  <xml name="inputs_set_figure_params"><param name="scanpy" type="bool" value="True" optional="true" label="scanpy" help="    Init default values for ``matplotlib.rcParams`` suited for Scanpy."/>
    <param name="dpi" type="int" value="80" optional="true" label="dpi" help="    Resolution of rendered figures - this influences the size of figures in notebooks."/>
    <param name="dpi_save" type="int" value="150" optional="true" label="dpi_save" help="    Resolution of saved figures. This should typically be higher to achieve    publication quality."/>
    <param name="frameon" type="bool" value="True" optional="true" label="frameon" help="    Add frames and axes labels to scatter plots."/>
    <param name="vector_friendly" type="bool" value="True" optional="true" label="vector_friendly" help="    Plot scatter plots using `png` backend even when exporting as `pdf` or `svg`."/>
    <param name="color_map" type="str" value="None" optional="true" label="color_map" help="    Convenience method for setting the default color map."/>
    <param name="format" type="data" format="{'png'" value="" optional="true" label="format" help="    This sets the default format for saving figures: `file_format_figs`."/>
    <param name="transparent" type="bool" value="True" optional="true" label="transparent" help="    Save figures with transparent back ground. Sets    `rcParams['savefig.transparent']`."/>
    <param name="ipython_format" type="data" format="list of `str`" value="" optional="true" label="ipython_format" help="    Only concerns the notebook/IPython environment; see    `IPython.core.display.set_matplotlib_formats` for more details."/>
    </xml>
  <xml name="outputs_set_figure_params"/>
  <token name="@CMD_set_figure_params@"><![CDATA[
sc.set_figure_params(
   scanpy = '$pl_settings.scanpy',
   dpi = '$pl_settings.dpi',
   dpi_save = '$pl_settings.dpi_save',
   frameon = '$pl_settings.frameon',
   vector_friendly = '$pl_settings.vector_friendly',
   color_map = '$pl_settings.color_map',
   format = '$pl_settings.format',
   transparent = '$pl_settings.transparent',
   ipython_format = '$pl_settings.ipython_format',)]]></token>
</macros>
