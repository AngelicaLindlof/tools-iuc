<tool id="pp.downsample_counts" name="pp.downsample_counts" version="1.3.1+galaxy1">
  <description>Downsample counts so that each cell has no more than `target_counts`.</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="exit_code"><![CDATA[
        python $script_file
    ]]></command>
  <configfiles>
    <configfile name="script_file"><![CDATA[
import scanpy.api as sc

@CMD_read_inputs

sc.pp.downsample_counts(
   adata = '$adata',
   target_counts = '$target_counts',
   random_state = '$random_state',
   copy = '$copy',)

adata.write_loom($csv_output)
adata.write_csv($loom_output)
]]></configfile>
  </configfiles>
  <inputs>
    <expand macro="inputs_anndata"/>
    <param name="target_counts" type="int" value="" label="target_counts" help="    Target number of counts for downsampling. Cells with more counts than    'target_counts' will be downsampled to have 'target_counts' counts."/>
    <param name="random_state" type="int" value="" optional="true" label="random_state" help="    Random seed to change subsampling."/>
    <param name="copy" type="bool" value="False" optional="true" label="copy" help="    If an :class:`~anndata.AnnData` is passed, determines whether a copy    is returned."/>
    </inputs>
  <outputs>
    <data name="csv_output" type="data" format="csv" label="${tool.name} on ${on_string}: Annotated matrix (csv)"/>
    <data name="loom_output" type="data" format="loom" label="${tool.name} on ${on_string}: Annotated matrix (loom)"/>
    </outputs>
  <tests>
    <test>
      <param name="target_counts" value=""/>
      <param name="random_state" value=""/>
      <param name="copy" value=""/>
      <output name="loom_output" file=""/>
      <output name="csv_output" file=""/>
      <output name="loom_output" file=""/>
    </test>
  </tests>
  <help><![CDATA[
        Downsample counts so that each cell has no more than `target_counts`.

Cells with fewer counts than `target_counts` are unaffected by this. This
has been implemented by M. D. Luecken.

Parameters
----------
adata : :class:`~anndata.AnnData`
    Annotated data matrix.
target_counts : `int` (default: 20,000)
    Target number of counts for downsampling. Cells with more counts than
    'target_counts' will be downsampled to have 'target_counts' counts.
random_state : `int` or `None`, optional (default: 0)
    Random seed to change subsampling.
copy : `bool`, optional (default: `False`)
    If an :class:`~anndata.AnnData` is passed, determines whether a copy
    is returned.

Returns
-------
Depending on `copy` returns or updates an `adata` with downsampled `.X`.
    ]]></help>
  <expand macro="citations"/>
</tool>
