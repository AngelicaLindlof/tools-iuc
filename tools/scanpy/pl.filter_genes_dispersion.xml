<tool id="pl.filter_genes_dispersion" name="pl.filter_genes_dispersion" version="1.3.1+galaxy1">
    <description>Plot dispersions versus means for genes.</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
          python $script_file
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@

sc.settings.figdir = '.'

df = pd.read_csv('$result', sep='\t', index_col = 0)
res = df.to_records(index=False)

sc.pl.filter_genes_dispersion(
   result=res,
   log=$log,
   show=False,
   save='.$format')
]]></configfile>
    </configfiles>
    <inputs>
        <param argument="result" type="data" format="tabular,csv" label="Filter genes" help="Output of pp.filter_genes_dispersion when annotated data matrix is not modified" />
        <param argument="log" type="boolean" truevalue="True" falsevalue="False" checked="true" label="Plot on logarithmic axes" help=""/>
        <param name="format" type="select" label="Format for saving figures">
            <option value="png">png</option>
            <option value="pdf">pdf</option>
            <option value="svg">svg</option>
        </param>
    </inputs>
    <outputs>
        <data name="out_png" format="png" from_work_dir="filter_genes_dispersion.png" label="${tool.name} on ${on_string}">
            <filter>format == 'png'</filter>
        </data>
        <data name="out_pdf" format="pdf" from_work_dir="filter_genes_dispersion.pdf" label="${tool.name} on ${on_string}">
            <filter>format == 'pdf'</filter>
        </data>
        <data name="out_svg" format="svg" from_work_dir="filter_genes_dispersion.svg" label="${tool.name} on ${on_string}">
            <filter>format == 'svg'</filter>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="result" value="pp.filter_genes_dispersion.per_gene.krumsiek11-cell_ranger.tabular"/>
            <param name="log" value="True"/>
            <param name="format" value="png"/>
            <output name="out_png" file="pl.filter_genes_dispersion.per_gene.krumsiek11.png"/>
        </test>
    </tests>
    <help><![CDATA[
Plot dispersions versus means for genes, produces Supp. Fig. 5c of Zheng et al. (2017) and MeanVarPlot() of Seurat.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.filter_genes_dispersion.html#scanpy.api.pl.filter_genes_dispersion>`__
    ]]></help>
    <expand macro="citations"/>
</tool>
