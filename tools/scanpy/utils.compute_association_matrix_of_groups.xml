<tool id="utils.compute_association_matrix_of_groups" name="utils.compute_association_matrix_of_groups" version="1.3.1+galaxy1">
  <description>Compute overlaps between groups.</description>
  <macros>
    <import>macros.xml</import>
  </macros>
  <expand macro="requirements"/>
  <command detect_errors="exit_code"><![CDATA[
        python $script_file
    ]]></command>
  <configfiles>
    <configfile name="script_file"><![CDATA[
import scanpy.api as sc

@CMD_read_inputs

sc.utils.compute_association_matrix_of_groups(
   adata = '$adata',
   prediction = '$prediction',
   reference = '$reference',
   normalization = '$normalization',
   threshold = '$threshold',
   max_n_names = '$max_n_names',)
]]></configfile>
  </configfiles>
  <inputs>
    <expand macro="inputs_anndata"/>
    <param name="prediction" type="data" format="str" value="" label="prediction" help="    Field name of adata.obs."/>
    <param name="reference" type="data" format="str" value="" label="reference" help="    Field name of adata.obs."/>
    <param name="normalization" type="data" format="{'prediction'" value="" label="normalization" help="    Whether to normalize with respect to the predicted groups or the    reference groups."/>
    <param name="threshold" type="data" format="float" value="" optional="true" label="threshold" help="    Do not consider associations whose overlap is below this fraction."/>
    <param name="max_n_names" type="data" format="int or None" value="" optional="true" label="max_n_names" help="    Control how many reference names you want to be associated with per    predicted name. Set to `None`, if you want all."/>
    </inputs>
  <outputs>
    <data name="Tuple of" type="data" format="" label="${tool.name} on ${on_string}: Tuple of"/>
    <data name="asso_names" type="data" format="list of associated reference names " label="${tool.name} on ${on_string}: asso_names"/>
    <data name="asso_matrix" type="data" format="matrix where rows correspond to the predicted labels and" label="${tool.name} on ${on_string}: asso_matrix"/>
    </outputs>
  <tests>
    <test>
      <param name="prediction" value=""/>
      <param name="reference" value=""/>
      <param name="normalization" value=""/>
      <param name="threshold" value=""/>
      <param name="max_n_names" value=""/>
      <output name="Tuple of" file=""/>
      <output name="asso_names" file=""/>
      <output name="asso_matrix" file=""/>
    </test>
  </tests>
  <help><![CDATA[
        Compute overlaps between groups.

See ``identify_groups`` for identifying the groups.

Parameters
----------
adata : AnnData
prediction : str
    Field name of adata.obs.
reference : str
    Field name of adata.obs.
normalization : {'prediction', 'reference'}
    Whether to normalize with respect to the predicted groups or the
    reference groups.
threshold : float, optional (default: 0.01)
    Do not consider associations whose overlap is below this fraction.
max_n_names : int or None, optional (default: 2)
    Control how many reference names you want to be associated with per
    predicted name. Set to `None`, if you want all.

Returns
-------
Tuple of
asso_names : list of associated reference names (`max_n_names` for each
    predicted name)
asso_matrix : matrix where rows correspond to the predicted labels and
    columns to the reference labels, entries are proportional to degree of
    association
    ]]></help>
  <expand macro="citations"/>
</tool>
