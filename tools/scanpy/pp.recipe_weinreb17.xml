<tool id="pp.recipe_weinreb17" name="pp.recipe_weinreb17" version="1.3.1+galaxy1">
    <description>Normalization and filtering as of Weinreb et al (2017)</description>
    <macros>
        <import>macros.xml</import>
        <import>pca_macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
          python $script_file
      ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.pp.recipe_weinreb17(
    adata=adata,
    log=$log,
    mean_threshold=$mean_threshold,
    cv_threshold=$cv_threshold,
    n_pcs=$n_pcs,
    svd_solver='$svd_solver',
    random_state=$random_state,
    copy=False)

@CMD_anndata_write_outputs@
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="inputs_anndata"/>
        <expand macro="param_log"/>
        <param argument="mean_threshold" type="float" value="0.01" label="Mean threshold" help=""/>
        <param argument="cv_threshold" type="float" value="2" label="CV threshold" help=""/>
        <param argument="n_pcs" type="integer" value="50" label="Number of principal component" help=""/>
        <expand macro="svd_solver"/>
        <expand macro="pca_random_state"/>
        <expand macro="anndata_output_format"/>
    </inputs>
    <outputs>
        <expand macro="anndata_outputs"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="paul15.h5ad" />
            </conditional>
            <param name="log" value="true"/>
            <param name="mean_threshold" value="0.01"/>
            <param name="cv_threshold" value="2"/>
            <param name="n_pcs" value="50"/>
            <param name="svd_solver" value="randomized"/>
            <param name="random_state" value="0"/>
            <param name="anndata_output_format" value="h5ad" />
            <output name="anndata_out_h5ad" file="pp.recipe_weinreb17.paul15.h5ad" ftype="h5" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
Normalization and filtering as of Weinreb et al (2017).

Expects non-logarithmized data. If using logarithmized data, pass `log=False`.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pp.recipe_weinreb17.html#scanpy.api.pp.recipe_weinreb17>`__
    ]]></help>
    <expand macro="citations"/>
</tool>
