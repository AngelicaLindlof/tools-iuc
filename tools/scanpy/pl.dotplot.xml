<tool id="pl.dotplot" name="pl.dotplot" version="1.3.1+galaxy1">
    <description>Makes a dot plot of the expression values</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code"><![CDATA[
            python $script_file
        ]]></command>
    <configfiles>
        <configfile name="script_file"><![CDATA[
@CMD_imports@
@CMD_read_inputs@

sc.settings.figdir = '.'

@CMD_params_var_group@

sc.pl.dotplot(@CMD_params_plots@ @CMD_params_figsize@ color_map='$color_map', @CMD_params_matplotlib_pyplot_scatter@ show=False)
]]></configfile>
    </configfiles>
    <inputs>
        <expand macro="params_plots"/>
        <expand macro="param_figsize"/>
        <param argument="color_map" type="select" label="Color palette">
            <expand macro="matplotlib_pyplot_colormap"/>
        </param>
        <expand macro="params_matplotlib_pyplot_scatter"/>
    </inputs>   
    <outputs>
        <expand macro="plot_output"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="format" value="h5ad" />
                <param name="adata" value="krumsiek11.h5ad" />
            </conditional>
            <conditional name="var_names">
                <param name="type" value="all"/>
            </conditional>
            <param name="groupby" value="cell_type"/>
            <param name="log" value="False"/>
            <param name="use_raw" value="False"/>
            <param name="num_categories" value="7"/>
            <param name="dendrogram" value="False"/>
            <param name="format" value="png"/>
            <conditional name="figsize">
                <param name="test" value="no"/>
            </conditional>
            <section name="matplotlib_pyplot_scatter">
                <param name="marker" value="o"/>
                <param name="linewidths" value="0" />
                <param name="edgecolors" value="face"/>
            </section>
            <output name="out_png" file="pl.dotplot.krumsiek11.png" ftype="png" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[
For each var_name and each `groupby` category a dot is plotted. Each dot
represents two values: mean expression within each category (visualized by
color) and fraction of cells expressing the var_name in the
category. (visualized by the size of the dot).  If groupby is not given, the
dotplot assumes that all data belongs to a single category. A gene is not
considered expressed if the expression value in the adata (or adata.raw) is
equal to zero.

For instance, for each marker gene, the mean value and the percentage of cells
expressing the gene can be visualized for each cluster.

More details on the `scanpy documentation
<https://scanpy.readthedocs.io/en/latest/api/scanpy.api.pl.dotplot.html#scanpy.api.pl.dotplot>`__
    ]]></help>
    <expand macro="citations"/>
</tool>
